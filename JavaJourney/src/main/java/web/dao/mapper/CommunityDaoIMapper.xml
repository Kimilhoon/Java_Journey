<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="web.dao.face.CommunityDao">
	
	<!--수정해야댐 ㅜ -->
	<select id="selectCafeReview" resultType="CafeRev" parameterType="hashmap">
	
		SELECT revno, cr.cafeno, userno, revcontent, revhit, revdate, revsp, cafename, cafeloc
		FROM caferev cr
		JOIN cafe c ON cr.cafeno = c.cafeno
		ORDER BY revno desc
	
	</select>
	
	<select id="selectCafeReviewCommentListByCafeReviewNo" resultType="CafeRevComm" parameterType="CafeRev">
	
		SELECT * FROM caferevcomm
		<where>
			AND revNo = #{revNo }
		</where>
		ORDER BY caferevcommno desc
		
	</select>
	
	<select id="selectCafeReviewInfo" resultType="CafeRev" parameterType="CafeRev">

		SELECT revno, cr.cafeno, userno, revcontent, revhit, revdate, revsp, cafename, cafeloc
		FROM caferev cr
		JOIN cafe c ON cr.cafeno = c.cafeno
		<where>
			AND revNo = #{revNo }
		</where>
		ORDER BY revno desc
	
	</select>
	
	<select id="selectCafeNameByCafeNo" resultType="string" parameterType="Cafe">
		SELECT cafeName FROM cafe
		<where>
			AND cafeNo = #{cafeNo }
		</where>
	</select>

	<select id="getFreeBoardTotalCnt" parameterType="hashmap" resultType="int">
		SELECT count(*) FROM FREEBOARD
		<where>
			<if test='category != "N" '>
				AND FREEBOARDCATEGORY = #{category}
			</if>
			<if test='search != "N" '>
				AND upper(FREEBOARDTITLE) LIKE '%'||upper(#{search})||'%'
			</if>
		</where>
	</select>
	
	<select id="selectFreeBoardListAll" parameterType="hashmap" resultType="FreeBoard">
		SELECT FREEBOARDNO,USERNO,FREEBOARDCATEGORY,FREEBOARDTITLE,FREEBOARDCONTENT,FREEBOARDHIT,FREEBOARDWRITEDATE,FREEIMGNO  
		FROM (
			SELECT rownum r,a.* FROM(
				SELECT * FROM FREEBOARD 
				WHERE upper(FREEBOARDTITLE) LIKE '%'||upper(#{search})||'%'
				ORDER BY FREEBOARDNO DESC
				)a
			)
		WHERE r BETWEEN #{paging.startNo} AND #{paging.endNo}
	</select>
	
	<select id="selectFreeBoardByFreeBoardNo" parameterType="FreeBoard" resultType="FreeBoard">
		SELECT * FROM FREEBOARD
		WHERE freeboardno = #{freeBoardNo}
	</select>
	
	<select id="selectMemberByFreeBoardNo" parameterType="FreeBoard">
		SELECT * FROM MEMBER
		WHERE userno = #{userNo}
	</select>
	
	<select id="selectUsernoByUserid" resultType="int" parameterType="string">
		SELECT userno FROM member
		<where>
			userId = #{userId }
		</where>
	</select>
	
	<insert id="insertCafeReview" parameterType="CafeRev">
		INSERT INTO caferev (revNo, cafeNo, userNo, revContent, revHit, revDate, revsp)
		VALUES ( #{revNo_seq.nextval }, #{cafeNo }, #{userNo }, #{revContent }, 0, sysdate, #{revsp } )
	</insert>
	
	<select id="selectWriterId" resultType="string" parameterType="CafeRev">
		SELECT userid
		FROM CAFEREV c, MEMBER m
		<where>
			AND c.USERNO = m.USERNO 
			AND c.userNo = #{userNo }
		</where>
	</select>
	
	<delete id="deleteCafeReviewByCafeNo" parameterType="CafeRev">
		DELETE CafeRev
		<where>
			AND revNo = #{revNo }
		</where>
	</delete>
	
</mapper>





















